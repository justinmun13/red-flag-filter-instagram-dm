<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö© Red Flag Filter - AI Dating Safety Shield</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --danger-color: #ff4757;
            --warning-color: #ffa502;
            --info-color: #3742fa;
            --success-color: #2ed573;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.8);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Animated Background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 206, 84, 0.3) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(255, 71, 87, 0.3) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            z-index: -1;
        }

        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Header Section */
        .header {
            text-align: center;
            padding: 4rem 2rem 2rem;
            position: relative;
        }

        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--danger-color), var(--warning-color), var(--success-color));
            border-radius: 2px;
        }

        .main-title {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            margin-bottom: 1rem;
            background: linear-gradient(45deg, #ff4757, #ffa502, #2ed573, #3742fa);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientFlow 6s ease-in-out infinite;
            text-shadow: 0 0 50px rgba(255, 255, 255, 0.3);
            letter-spacing: -2px;
        }

        @keyframes gradientFlow {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .subtitle {
            font-size: 1.4rem;
            color: var(--text-secondary);
            font-weight: 300;
            max-width: 800px;
            margin: 0 auto 2rem;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 16px 32px;
            border-radius: 50px;
            font-weight: 600;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .status-indicator:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: var(--success-color);
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 0 var(--success-color);
        }

        @keyframes pulse {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(46, 213, 115, 0.7);
            }
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(46, 213, 115, 0);
            }
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(46, 213, 115, 0);
            }
        }

        /* Main Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Glass Card Component */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .glass-card:hover::before {
            left: 100%;
        }

        .glass-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
        }

        /* Safety Score Section */
        .safety-section {
            margin-bottom: 3rem;
        }

        .score-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4rem;
            flex-wrap: wrap;
        }

        .score-circle {
            position: relative;
            width: 250px;
            height: 250px;
        }

        .score-svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .score-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.1);
            stroke-width: 12;
        }

        .score-progress {
            fill: none;
            stroke: var(--success-color);
            stroke-width: 12;
            stroke-linecap: round;
            stroke-dasharray: 628;
            stroke-dashoffset: 628;
            animation: scoreAnimation 2s ease-out forwards;
        }

        @keyframes scoreAnimation {
            to {
                stroke-dashoffset: calc(628 - (628 * 87) / 100);
            }
        }

        .score-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .score-number {
            font-size: 3rem;
            font-weight: 900;
            line-height: 1;
        }

        .score-label {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        .score-details {
            flex: 1;
            min-width: 300px;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .breakdown-item {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .breakdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }

        .breakdown-number {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .breakdown-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .full-width {
            grid-column: 1 / -1;
        }

        /* Test Section */
        .test-section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .test-area {
            position: relative;
        }

        .test-input {
            width: 100%;
            min-height: 120px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            color: white;
            font-size: 1.1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .test-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .test-input:focus {
            outline: none;
            border-color: var(--info-color);
            box-shadow: 0 0 0 3px rgba(55, 66, 250, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .test-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--info-color), #5352ed);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Quick Test Examples */
        .quick-examples {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .example-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .example-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        .example-text {
            font-size: 0.9rem;
            font-style: italic;
            margin-bottom: 0.5rem;
        }

        .example-risk {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .risk-critical { color: var(--danger-color); }
        .risk-high { color: var(--warning-color); }
        .risk-medium { color: var(--info-color); }
        .risk-low { color: var(--success-color); }

        /* Analysis Result */
        .analysis-result {
            margin-top: 2rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .risk-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-critical {
            background: linear-gradient(45deg, var(--danger-color), #ff3838);
            color: white;
        }

        .badge-high {
            background: linear-gradient(45deg, var(--warning-color), #ff6348);
            color: white;
        }

        .badge-medium {
            background: linear-gradient(45deg, var(--info-color), #5352ed);
            color: white;
        }

        .badge-low {
            background: linear-gradient(45deg, var(--success-color), #20bf6b);
            color: white;
        }

        .red-flags-section {
            margin: 1.5rem 0;
        }

        .flag-item {
            background: rgba(255, 71, 87, 0.1);
            border-left: 4px solid var(--danger-color);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .flag-category {
            font-weight: 600;
            color: var(--danger-color);
            text-transform: capitalize;
            margin-bottom: 0.25rem;
        }

        .recommendations-section {
            background: rgba(46, 213, 115, 0.1);
            border-left: 4px solid var(--success-color);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .recommendation-item {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .recommendation-item::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: var(--success-color);
            font-weight: bold;
        }

        /* Chart Section */
        .chart-container {
            height: 400px;
            position: relative;
            margin-top: 1rem;
        }

        /* Alerts Section */
        .alerts-grid {
            display: grid;
            gap: 1.5rem;
        }

        .alert-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .alert-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .alert-critical::before { background: var(--danger-color); }
        .alert-high::before { background: var(--warning-color); }
        .alert-medium::before { background: var(--info-color); }

        .alert-card:hover {
            transform: translateX(8px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .alert-sender {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .alert-time {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .alert-message {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 8px;
            font-style: italic;
            margin: 1rem 0;
            border-left: 3px solid var(--info-color);
        }

        /* No data state */
        .no-data {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .no-data i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Loading states */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: var(--info-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .score-container {
                flex-direction: column;
                gap: 2rem;
            }
            
            .score-circle {
                width: 200px;
                height: 200px;
            }
            
            .test-controls {
                flex-direction: column;
            }
            
            .btn {
                justify-content: center;
            }
            
            .breakdown-item {
                padding: 1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 1rem;
            }
            
            .header {
                padding: 2rem 1rem 1rem;
            }
            
            .glass-card {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1 class="main-title">üö© Red Flag Filter</h1>
        <p class="subtitle">AI-Powered Instagram DM Safety Analysis - Protecting You from Dating Manipulation & Financial Scams</p>
        <div class="status-indicator" id="statusIndicator">
            <div class="pulse-dot"></div>
            <span id="statusText">AI Protection Active</span>
        </div>
    </header>

    <div class="container">
        <!-- Safety Score Section -->
        <section class="safety-section">
            <div class="glass-card full-width">
                <div class="score-container">
                    <div class="score-circle">
                        <svg class="score-svg" viewBox="0 0 200 200">
                            <circle cx="100" cy="100" r="90" class="score-bg"/>
                            <circle cx="100" cy="100" r="90" class="score-progress" id="scoreProgress"/>
                        </svg>
                        <div class="score-text">
                            <div class="score-number" id="scoreNumber">87</div>
                            <div class="score-label">Safety Score</div>
                        </div>
                    </div>
                    <div class="score-details">
                        <h2 class="section-title">üõ°Ô∏è Safety Analysis Overview</h2>
                        <p>Your Instagram conversations have been analyzed for potential threats and manipulation patterns. The safety score reflects the overall security of your digital interactions.</p>
                        <div class="score-breakdown">
                            <div class="breakdown-item">
                                <div class="breakdown-number risk-critical" id="criticalCount">2</div>
                                <div class="breakdown-label">Critical Threats</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-number risk-high" id="highCount">3</div>
                                <div class="breakdown-label">High Risk</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-number risk-medium" id="mediumCount">5</div>
                                <div class="breakdown-label">Medium Risk</div>
                            </div>
                            <div class="breakdown-item">
                                <div class="breakdown-number risk-low" id="totalScanned">124</div>
                                <div class="breakdown-label">Messages Analyzed</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Live Testing Section -->
        <section class="test-section">
            <div class="glass-card full-width">
                <h2 class="section-title">üß™ Live Red Flag Analysis</h2>
                <div class="test-area">
                    <textarea 
                        id="testMessage" 
                        class="test-input" 
                        placeholder="Enter a message to analyze for red flags...

Try testing with suspicious messages like financial requests, love bombing, or inappropriate content to see the AI in action."
                    ></textarea>
                    <div class="test-controls">
                        <button class="btn btn-primary" onclick="analyzeMessage()">
                            <i class="fas fa-search"></i>
                            Analyze Message
                        </button>
                        <button class="btn btn-secondary" onclick="clearAnalysis()">
                            <i class="fas fa-eraser"></i>
                            Clear
                        </button>
                    </div>
                </div>

                <!-- Quick Test Examples -->
                <div class="quick-examples">
                    <div class="example-card" onclick="loadExample(0)">
                        <div class="example-text">"You're so different from other girls, I love you already! We're soulmates."</div>
                        <div class="example-risk risk-high">High Risk - Love Bombing</div>
                    </div>
                    <div class="example-card" onclick="loadExample(1)">
                        <div class="example-text">"I'm stranded and need $500 for emergency flight home. I'll pay you back!"</div>
                        <div class="example-risk risk-critical">Critical - Financial Scam</div>
                    </div>
                    <div class="example-card" onclick="loadExample(2)">
                        <div class="example-text">"Send me some pics, what are you wearing right now? üòè"</div>
                        <div class="example-risk risk-high">High Risk - Sexual Pressure</div>
                    </div>
                    <div class="example-card" onclick="loadExample(3)">
                        <div class="example-text">"Hey! How was your day? Want to grab coffee this weekend?"</div>
                        <div class="example-risk risk-low">Low Risk - Safe</div>
                    </div>
                </div>

                <!-- Analysis Result -->
                <div id="analysisResult" style="display: none;"></div>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Threat Analysis Chart -->
            <div class="glass-card">
                <h2 class="section-title">üìä Threat Distribution</h2>
                <div class="chart-container">
                    <canvas id="threatChart"></canvas>
                </div>
            </div>

            <!-- Recent Alerts -->
            <div class="glass-card">
                <h2 class="section-title">üö® Recent Security Alerts</h2>
                <div class="alerts-grid" id="alertsContainer">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const API_BASE = '';
        const examples = [
            "You're so different from other girls, I love you already! We're soulmates.",
            "I'm stranded and need $500 for emergency flight home. I'll pay you back!",
            "Send me some pics, what are you wearing right now? üòè",
            "Hey! How was your day? Want to grab coffee this weekend?"
        ];

        // State
        let isConnectedToBackend = false;
        let currentChart = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üö© Red Flag Filter Dashboard Loading...');
            initializeDashboard();
        });

        async function initializeDashboard() {
            try {
                await loadRealData();
                setupAnimations();
                console.log('‚úÖ Dashboard initialized successfully');
            } catch (error) {
                console.warn('Backend not available, using demo mode:', error);
                loadDemoData();
                updateStatus(false);
            }
        }

        // Load real data from your backend
        async function loadRealData() {
            console.log('Attempting to connect to your Red Flag Detector backend...');
            
            // Test connection
            const response = await fetch('/api/stats');
            if (!response.ok) throw new Error('Backend not available');
            
            const [statsData, alertsData] = await Promise.all([
                fetch('/api/stats').then(r => r.json()),
                fetch('/api/alerts').then(r => r.json())
            ]);

            updateStats(statsData);
            updateAlerts(alertsData.alerts || []);
            updateChart(alertsData.alerts || []);
            updateStatus(true);
            
            isConnectedToBackend = true;
            console.log('‚úÖ Connected to your Red Flag Detector backend');
        }

        // Demo data fallback
        function loadDemoData() {
            console.log('Loading demo data...');
            
            const demoStats = {
                critical_count: 2,
                high_count: 3,
                medium_count: 5,
                messages_scanned: 124
            };
            
            const demoAlerts = [
                {
                    sender: '@financial_scammer',
                    timestamp: new Date(Date.now() - 1800000).toISOString(),
                    risk_level: 'critical',
                    message: 'I\'m stranded in Nigeria and need $2000 for emergency flight home. I promise I\'ll pay you back with interest!',
                    red_flags: [
                        { category: 'financial_scam', explanation: 'Classic stranded abroad money scam' },
                        { category: 'false_promises', explanation: 'Unrealistic repayment promises' }
                    ]
                },
                {
                    sender: '@love_bomber',
                    timestamp: new Date(Date.now() - 7200000).toISOString(),
                    risk_level: 'high',
                    message: 'You\'re so perfect baby! I love you more than anything. We\'re soulmates and meant to be together forever!',
                    red_flags: [
                        { category: 'love_bombing', explanation: 'Excessive romantic declarations too early' },
                        { category: 'manipulation', explanation: 'Intense emotional pressure' }
                    ]
                }
            ];

            updateStats(demoStats);
            updateAlerts(demoAlerts);
            updateChart(demoAlerts);
        }

        // Update statistics
        function updateStats(stats) {
            document.getElementById('criticalCount').textContent = stats.critical_count || 0;
            document.getElementById('highCount').textContent = stats.high_count || 0;
            document.getElementById('mediumCount').textContent = stats.medium_count || 0;
            document.getElementById('totalScanned').textContent = stats.messages_scanned || 0;
        }

        // Update alerts display
        function updateAlerts(alerts) {
            const container = document.getElementById('alertsContainer');
            
            if (!alerts || alerts.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-shield-alt"></i>
                        <h3>No Threats Detected</h3>
                        <p>Your conversations appear safe. Continue monitoring for peace of mind.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = alerts.map(createAlertCard).join('');
        }

        // Create alert card HTML
        function createAlertCard(alert) {
            const timeAgo = getTimeAgo(new Date(alert.timestamp));
            const riskClass = `alert-${alert.risk_level}`;
            
            return `
                <div class="alert-card ${riskClass}">
                    <div class="alert-header">
                        <span class="alert-sender">${alert.sender}</span>
                        <div>
                            <span class="alert-time">${timeAgo}</span>
                            <span class="risk-badge badge-${alert.risk_level}">${alert.risk_level.toUpperCase()}</span>
                        </div>
                    </div>
                    
                    <div class="alert-message">
                        "${alert.message}"
                    </div>
                    
                    ${alert.red_flags && alert.red_flags.length > 0 ? `
                        <div class="red-flags-section">
                            <h4>üö© Red Flags Detected:</h4>
                            ${alert.red_flags.map(flag => `
                                <div class="flag-item">
                                    <div class="flag-category">${flag.category.replace(/_/g, ' ')}</div>
                                    <div>${flag.explanation}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    <div class="recommendations-section">
                        <h4>üí° Recommended Actions:</h4>
                        ${generateRecommendations(alert.risk_level, alert.red_flags).map(rec => `
                            <div class="recommendation-item">${rec}</div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Generate recommendations based on risk level
        function generateRecommendations(riskLevel, redFlags) {
            const recommendations = [];
            
            switch(riskLevel) {
                case 'critical':
                    recommendations.push(
                        'üö® BLOCK IMMEDIATELY - This person shows dangerous patterns',
                        'üì∏ Screenshot evidence before blocking',
                        'üìû Report to Instagram and consider authorities'
                    );
                    break;
                case 'high':
                    recommendations.push(
                        '‚ö†Ô∏è Exercise extreme caution with this person',
                        'üö´ Do not share personal information',
                        'üë• Tell trusted friends about this interaction'
                    );
                    break;
                case 'medium':
                    recommendations.push(
                        '‚ö° Be cautious - concerning patterns detected',
                        'üé≠ Keep conversations public and light',
                        'üëÄ Watch for escalating behavior'
                    );
                    break;
                default:
                    recommendations.push('‚úÖ Continue with normal caution');
            }

            // Add specific recommendations based on red flags
            if (redFlags) {
                const categories = redFlags.map(flag => flag.category).join(' ');
                if (categories.includes('financial')) {
                    recommendations.push('üí∞ NEVER send money to online contacts');
                }
                if (categories.includes('love_bombing')) {
                    recommendations.push('üíï Healthy relationships develop slowly over time');
                }
                if (categories.includes('sexual')) {
                    recommendations.push('üö´ You are not obligated to send photos');
                }
            }

            return recommendations;
        }

        // Update threat chart
        function updateChart(alerts) {
            const canvas = document.getElementById('threatChart');
            if (!canvas) return;

            // Clear existing chart
            if (currentChart) {
                currentChart.destroy();
            }

            // Count threat types
            const threatCounts = {
                'Financial Scams': 0,
                'Love Bombing': 0,
                'Sexual Pressure': 0,
                'Manipulation': 0,
                'Threats': 0
            };

            alerts.forEach(alert => {
                if (alert.red_flags) {
                    alert.red_flags.forEach(flag => {
                        const category = flag.category.toLowerCase();
                        if (category.includes('financial')) threatCounts['Financial Scams']++;
                        else if (category.includes('love') || category.includes('bombing')) threatCounts['Love Bombing']++;
                        else if (category.includes('sexual')) threatCounts['Sexual Pressure']++;
                        else if (category.includes('manipulation') || category.includes('guilt')) threatCounts['Manipulation']++;
                        else if (category.includes('threat') || category.includes('aggressive')) threatCounts['Threats']++;
                    });
                }
            });

            // Create chart
            const ctx = canvas.getContext('2d');
            currentChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(threatCounts),
                    datasets: [{
                        data: Object.values(threatCounts),
                        backgroundColor: [
                            '#ff4757',
                            '#ffa502',
                            '#3742fa',
                            '#a55eea',
                            '#2ed573'
                        ],
                        borderWidth: 0,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                padding: 20,
                                usePointStyle: true,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        // Update connection status
        function updateStatus(connected) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusText.textContent = 'Real AI Protection Active';
                indicator.style.background = 'rgba(46, 213, 115, 0.2)';
            } else {
                statusText.textContent = 'Demo Mode - Connect Backend';
                indicator.style.background = 'rgba(255, 165, 2, 0.2)';
                indicator.querySelector('.pulse-dot').style.background = '#ffa502';
            }
        }

        // Analyze message function
        async function analyzeMessage() {
            const messageText = document.getElementById('testMessage').value.trim();
            if (!messageText) {
                alert('Please enter a message to analyze');
                return;
            }

            const button = document.querySelector('.btn-primary');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
            button.disabled = true;

            try {
                let result;
                
                if (isConnectedToBackend) {
                    // Use your actual Red Flag Detector
                    const response = await fetch('/api/test-message', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ message: messageText })
                    });
                    
                    if (!response.ok) throw new Error('Backend error');
                    result = await response.json();
                } else {
                    // Demo analysis
                    result = simulateAnalysis(messageText);
                }
                
                displayAnalysisResult(result);
                
            } catch (error) {
                console.error('Analysis error:', error);
                
                // Fallback to demo analysis
                const result = simulateAnalysis(messageText);
                displayAnalysisResult(result);
                
                // Show warning
                showBackendWarning();
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        }

        // Display analysis result
        function displayAnalysisResult(result) {
            const resultDiv = document.getElementById('analysisResult');
            
            const riskColors = {
                low: '#2ed573',
                medium: '#3742fa',
                high: '#ffa502',
                critical: '#ff4757'
            };

            const html = `
                <div class="analysis-result">
                    <div class="result-header">
                        <h3>üîç Analysis Result</h3>
                        <span class="risk-badge badge-${result.risk_level}">${result.risk_level.toUpperCase()}</span>
                    </div>
                    
                    <div class="alert-message">
                        "${result.message}"
                    </div>
                    
                    ${result.red_flags && result.red_flags.length > 0 ? `
                        <div class="red-flags-section">
                            <h4>üö© Red Flags Detected:</h4>
                            ${result.red_flags.map(flag => `
                                <div class="flag-item">
                                    <div class="flag-category">${flag.category.replace(/_/g, ' ')}</div>
                                    <div>${flag.explanation}</div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 1rem; color: ${riskColors.low};">
                            ‚úÖ No red flags detected in this message
                        </div>
                    `}
                    
                    <div class="recommendations-section">
                        <h4>üí° Recommendations:</h4>
                        ${(result.recommendations || generateRecommendations(result.risk_level, result.red_flags)).map(rec => `
                            <div class="recommendation-item">${rec}</div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 1rem; opacity: 0.7; text-align: center;">
                        Confidence: ${Math.round((result.confidence || 0.8) * 100)}%
                    </div>
                </div>
            `;
            
            resultDiv.innerHTML = html;
            resultDiv.style.display = 'block';
            
            // Scroll to result
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Demo analysis function
        function simulateAnalysis(message) {
            const lowerMessage = message.toLowerCase();
            let riskLevel = 'low';
            let redFlags = [];

            // Financial scam detection
            if (lowerMessage.includes('money') || lowerMessage.includes('send') || lowerMessage.includes('emergency') || 
                lowerMessage.includes('venmo') || lowerMessage.includes('cashapp') || lowerMessage.includes(')) {
                riskLevel = 'critical';
                redFlags.push({
                    category: 'financial_scam',
                    explanation: 'Money request detected - major red flag'
                });
            }

            // Love bombing detection
            if (lowerMessage.includes('love') || lowerMessage.includes('perfect') || lowerMessage.includes('soulmate') ||
                lowerMessage.includes('meant to be') || lowerMessage.includes('different from other')) {
                riskLevel = riskLevel === 'critical' ? 'critical' : 'high';
                redFlags.push({
                    category: 'love_bombing',
                    explanation: 'Excessive romantic language - love bombing detected'
                });
            }

            // Sexual pressure detection
            if (lowerMessage.includes('pics') || lowerMessage.includes('sexy') || lowerMessage.includes('wearing') ||
                (lowerMessage.includes('send') && (lowerMessage.includes('photo') || lowerMessage.includes('picture')))) {
                riskLevel = riskLevel === 'critical' ? 'critical' : 'high';
                redFlags.push({
                    category: 'sexual_pressure',
                    explanation: 'Inappropriate sexual requests detected'
                });
            }

            // Manipulation detection
            if (lowerMessage.includes('why aren\'t you') || lowerMessage.includes('ignoring me') || 
                lowerMessage.includes('don\'t care') || lowerMessage.includes('answer me')) {
                riskLevel = riskLevel === 'critical' ? 'critical' : (riskLevel === 'high' ? 'high' : 'medium');
                redFlags.push({
                    category: 'manipulation',
                    explanation: 'Guilt tripping and manipulative language detected'
                });
            }

            return {
                message: message,
                risk_level: riskLevel,
                red_flags: redFlags,
                confidence: redFlags.length > 0 ? 0.85 : 0.1
            };
        }

        // Load example message
        function loadExample(index) {
            document.getElementById('testMessage').value = examples[index];
        }

        // Clear analysis
        function clearAnalysis() {
            document.getElementById('testMessage').value = '';
            document.getElementById('analysisResult').style.display = 'none';
        }

        // Show backend warning
        function showBackendWarning() {
            const resultDiv = document.getElementById('analysisResult');
            const warning = document.createElement('div');
            warning.innerHTML = `
                <div style="background: rgba(255, 165, 2, 0.2); padding: 1rem; border-radius: 8px; margin-top: 1rem; border-left: 4px solid #ffa502;">
                    ‚ö†Ô∏è <strong>Demo Mode:</strong> Backend not connected. Start your Flask server with: <code>python app.py</code>
                </div>
            `;
            resultDiv.appendChild(warning);
        }

        // Setup animations
        function setupAnimations() {
            // Animate score circle
            const scoreProgress = document.getElementById('scoreProgress');
            const scoreNumber = document.getElementById('scoreNumber');
            
            let currentScore = 0;
            const targetScore = 87;
            const increment = targetScore / 50;
            
            const scoreAnimation = setInterval(() => {
                currentScore += increment;
                if (currentScore >= targetScore) {
                    currentScore = targetScore;
                    clearInterval(scoreAnimation);
                }
                
                scoreNumber.textContent = Math.round(currentScore);
                const circumference = 2 * Math.PI * 90;
                const offset = circumference - (currentScore / 100) * circumference;
                scoreProgress.style.strokeDashoffset = offset;
            }, 50);

            // Animate cards on scroll
            if (typeof gsap !== 'undefined') {
                gsap.from('.glass-card', {
                    duration: 1,
                    y: 50,
                    opacity: 0,
                    stagger: 0.2,
                    ease: 'power2.out'
                });
                
                gsap.from('.breakdown-item', {
                    duration: 0.8,
                    scale: 0.8,
                    opacity: 0,
                    stagger: 0.1,
                    delay: 0.5,
                    ease: 'back.out(1.7)'
                });
            }
        }

        // Utility function to get time ago
        function getTimeAgo(date) {
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / 60000);
            const diffHours = Math.floor(diffMs / 3600000);
            const diffDays = Math.floor(diffMs / 86400000);

            if (diffMins < 1) return 'Just now';
            if (diffMins < 60) return `${diffMins}m ago`;
            if (diffHours < 24) return `${diffHours}h ago`;
            return `${diffDays}d ago`;
        }

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            if (isConnectedToBackend) {
                loadRealData().catch(() => {
                    console.log('Backend connection lost, switching to demo mode');
                    isConnectedToBackend = false;
                    updateStatus(false);
                });
            }
        }, 30000);
    </script>
</body>
</html>